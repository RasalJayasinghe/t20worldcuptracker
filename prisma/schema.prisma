generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ── Teams ────────────────────────────────────────────────
model Team {
  id        String   @id @default(cuid())
  name      String   @unique
  shortName String
  flag      String // emoji flag
  group     String // e.g. "A", "B", "C", "D"

  homeMatches Match[] @relation("HomeTeam")
  awayMatches Match[] @relation("AwayTeam")
  standings   Standing[]
  predictions Prediction[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ── Matches ──────────────────────────────────────────────
model Match {
  id         String   @id @default(cuid())
  matchNum   Int? // match number in tournament
  homeTeamId String
  awayTeamId String
  homeTeam   Team     @relation("HomeTeam", fields: [homeTeamId], references: [id])
  awayTeam   Team     @relation("AwayTeam", fields: [awayTeamId], references: [id])

  date   DateTime?
  venue  String?
  status String    @default("upcoming") // upcoming | live | completed
  stage  String    @default("group") // group | super8 | semifinal | final
  group  String? // group letter for group-stage matches

  homeScore String? // e.g. "186/5 (20)"
  awayScore String? // e.g. "182/7 (20)"
  result    String? // e.g. "India won by 7 wickets"
  winnerId  String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@index([stage])
}

// ── Standings (one row per team per stage) ───────────────
model Standing {
  id       String @id @default(cuid())
  teamId   String
  team     Team   @relation(fields: [teamId], references: [id])
  group    String
  stage    String @default("group") // group | super8

  played   Int   @default(0)
  won      Int   @default(0)
  lost     Int   @default(0)
  tied     Int   @default(0)
  noResult Int   @default(0)
  points   Int   @default(0)
  nrr      Float @default(0)
  position Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([teamId, stage])
}

// ── Predictions ──────────────────────────────────────────
model Prediction {
  id     String @id @default(cuid())
  teamId String @unique
  team   Team   @relation(fields: [teamId], references: [id])

  super8Prob    Float @default(0) // 0–100
  semiFinalProb Float @default(0)
  finalProb     Float @default(0)
  winnerProb    Float @default(0)
  confidence    Float @default(0) // model confidence

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ── Scrape log ───────────────────────────────────────────
model ScrapeLog {
  id        String   @id @default(cuid())
  source    String
  status    String // success | error
  message   String?
  dataType  String // standings | matches | fixtures
  createdAt DateTime @default(now())
}
